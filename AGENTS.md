# OpenCode Insight - Agent Guide

This document provides essential context and guidelines for AI agents working on the OpenCode Insight project.

## 1. Project Overview

**OpenCode Insight** is a local web-based GUI for visualizing and monitoring OpenCode activities.
It is a **monorepo** structure, currently housing the main application in `packages/insight`.

### Tech Stack
- **Runtime**: [Bun](https://bun.sh) (v1.x)
- **Framework**: [SolidStart](https://start.solidjs.com) (SolidJS meta-framework)
- **Language**: TypeScript (Strict Mode)
- **Styling**: [Tailwind CSS](https://tailwindcss.com) (v4)
- **Database**: SQLite (via `better-sqlite3`) with [Drizzle ORM](https://orm.drizzle.team)
- **State Management**: Custom store in `src/core/store.ts` (using SolidJS reactivity)
- **Communication**: WebSocket (native `ws` library) for real-time updates

## 2. Environment Setup

The project relies on **Bun**. Ensure you are using `bun` commands, not `npm` or `yarn`.

### Key Directories
- `packages/insight/`: Main application root.
- `packages/insight/src/server/`: Backend WebSocket server & file watcher.
- `packages/insight/src/plugins/`: Feature-specific UI components (e.g., Session Monitor).
- `packages/insight/src/core/`: Core application logic (store, types, schema).
- `packages/insight/src/ui/`: Shared UI components.

## 3. Build & Run Commands

All commands should be run from **`packages/insight/`**.

| Action | Command | Description |
| :--- | :--- | :--- |
| **Install** | `bun install` | Install dependencies. |
| **Dev (Frontend)** | `bun run dev` | Starts the SolidStart dev server (Vite). |
| **Dev (Backend)** | `bun run start:server` | Starts the WebSocket server & database watcher (Port 3001). |
| **Build** | `bun run build` | Builds the application for production. |
| **Start (Prod)** | `bun run start` | Runs the built application. |
| **Seed DB** | `bun run seed` | Seeds the local SQLite database (`opencode.db`) with test data. |

**Important Development Note**:
To fully run the app in development, you need **two terminal processes**:
1. `bun run dev` (Frontend)
2. `bun run start:server` (Backend)

## 4. Code Style & Conventions

### General
- **Language**: TypeScript is mandatory. Use strict typing; avoid `any`.
- **Formatting**: Code should be clean and readable. Follow existing patterns as no explicit linter config is present.
- **Imports**: Use the `~/` alias for imports from `src/`.
  - ✅ `import { store } from "~/core/store";`
  - ❌ `import { store } from "../../core/store";`

### SolidJS & Components
- **Component Naming**: PascalCase (e.g., `SessionCard.tsx`).
- **File Structure**:
  - Components related to a specific feature go in `src/plugins/<FeatureName>/`.
  - Shared UI components go in `src/ui/`.
- **Reactivity**: Use SolidJS primitives (`createSignal`, `createEffect`, `Show`, `For`).
  - **Do not** destructure props in components (it breaks reactivity).
  - ✅ `props.active`
  - ❌ `const { active } = props;`

### Styling (Tailwind CSS)
- Use utility classes directly in `class` attributes.
- Use `clsx` or `cn` helper (if available) for conditional classes.
- Follow mobile-first responsive design if applicable.

### Backend (Server)
- Backend logic resides in `src/server/`.
- It uses `better-sqlite3` directly or via Drizzle ORM.
- WebSocket events are handled in `src/server/index.ts`.

## 5. Database
- The app uses a local SQLite database file: `opencode.db` (created in the project root or specified via `DB_PATH`).
- Schema definitions are in `packages/insight/src/core/schema.ts`.
- Use `bun run seed` to populate the database with mock data for testing.

## 6. Testing & Verification
- **No explicit unit tests** are currently set up.
- **Verification**:
  1. Run the frontend: `bun run dev`
  2. Run the backend: `bun run start:server`
  3. Manually verify the changes in the browser (usually `http://localhost:3000`).
- Ensure no console errors appear in either the browser or the server terminal.

## 7. Common Tasks

### Adding a New Feature
1. Create a new directory in `src/plugins/<FeatureName>/`.
2. Create components for the feature.
3. Register the feature in the main layout or dashboard if necessary.

### Modifying State
1. Update `src/core/store.ts` to add new state properties or actions.
2. Ensure state changes are reactive and propagate to components.

### Database Changes
1. If modifying the schema, ensure Drizzle definitions in `src/core/schema.ts` are updated.
2. Update seed scripts (`scripts/seed-db.ts`) if necessary to reflect schema changes.

---
*Generated by OpenCode Agent on 2026-02-15.*
